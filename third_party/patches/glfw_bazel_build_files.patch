Subject: [PATCH] Add bazel build files
Base-commit: b35641f4a3c62aa86a0b3c983d163bc0fe36026d

---
 BUILD.bazel  | 145 +++++++++++++++++++++++++++++++++++++++++++++++++++
 MODULE.bazel |   10 +++++
 2 files changed, 155 insertions(+)
 create mode 100644 BUILD.bazel
 create mode 100644 MODULE.bazel

diff --git a/BUILD.bazel b/BUILD.bazel
new file mode 100644
index 00000000..952ce1c3
--- /dev/null
+++ b/BUILD.bazel
@@ -0,0 +1,145 @@
+load("@rules_cc//cc:defs.bzl", "cc_library")
+load("@bazel_skylib//lib:selects.bzl", "selects")
+
+package(default_visibility = ["//visibility:public"])
+
+cc_library(
+    name = "glfw",
+    deps = selects.with_or({
+        ("@platforms//cpu:wasm32", "@platforms//cpu:wasm64"): [],
+        "//conditions:default": [":glfw_lib"],
+    }),
+    visibility = ["//visibility:public"],
+    linkopts = selects.with_or({
+        ("@platforms//cpu:wasm32", "@platforms//cpu:wasm64"): [
+            "-s USE_WEBGL2=1",
+            "-s USE_GLFW=3",
+            "-s FULL_ES3=1",
+            "-s WASM=1",
+            "-s USE_PTHREADS=1",
+        ],
+        "//conditions:default": [],
+    }),
+    hdrs = [
+        "include/GLFW/glfw3.h",
+        "include/GLFW/glfw3native.h",
+    ],
+    includes = ["include/"],
+)
+
+cc_library(
+    name = "glfw_lib",
+    srcs = [
+        "src/context.c",
+        "src/egl_context.c",
+        "src/init.c",
+        "src/input.c",
+        "src/monitor.c",
+        "src/null_init.c",
+        "src/null_joystick.c",
+        "src/null_monitor.c",
+        "src/null_window.c",
+        "src/osmesa_context.c",
+        "src/platform.c",
+        "src/posix_module.c",
+        "src/vulkan.c",
+        "src/window.c",
+    ] + selects.with_or({
+        "@bazel_tools//src/conditions:darwin": [],
+        "@bazel_tools//src/conditions:windows": [
+            "src/wgl_context.c",
+            "src/win32_init.c",
+            "src/win32_joystick.c",
+            "src/win32_monitor.c",
+            "src/win32_thread.c",
+            "src/win32_time.c",
+            "src/win32_window.c",
+        ],
+        ("@platforms//cpu:wasm32","@platforms//cpu:wasm64"): [
+            "src/posix_thread.c",
+        ],
+        "//conditions:default": [
+            "src/glx_context.c",
+            "src/linux_joystick.c",
+            "src/posix_thread.c",
+            "src/posix_time.c",
+            "src/x11_init.c",
+            "src/x11_monitor.c",
+            "src/x11_window.c",
+            "src/xkb_unicode.c",
+        ],
+    }),
+    hdrs = [
+        "include/GLFW/glfw3.h",
+        "include/GLFW/glfw3native.h",
+    ] + glob(["src/*.h"]),
+    copts = ["-std=c99"],
+    defines = selects.with_or({
+        "@bazel_tools//src/conditions:darwin": ["_GLFW_COCOA"],
+        "@bazel_tools//src/conditions:windows": ["_GLFW_WIN32"],
+        ("@platforms//cpu:wasm32","@platforms//cpu:wasm64"): [],
+        "//conditions:default": [
+            "_GLFW_X11",
+            "_POSIX_C_SOURCE=200809L",
+        ],
+    }),
+    includes = ["include/"],
+    linkopts = selects.with_or({
+        "@bazel_tools//src/conditions:darwin": [],
+        "@bazel_tools//src/conditions:windows": ["-lgdi32"],
+        ("@platforms//cpu:wasm32","@platforms//cpu:wasm64"): [
+            "-s USE_WEBGL2=1",
+            "-s USE_GLFW=3",
+            "-s FULL_ES3=1",
+            "-s WASM=1",
+            "-s USE_PTHREADS=1",
+        ],
+        "//conditions:default": [
+            "-lrt",
+            "-lX11",
+            "-lXrandr",
+            "-lXinerama",
+            "-lXcursor",
+            "-lXi",
+            "-lm",
+            "-ldl",
+            "-lGL",
+        ],
+    }),
+    deps = select({
+        "@bazel_tools//src/conditions:darwin": [":glfw_cocoa"],
+        "//conditions:default": [],
+    }),
+)
+
+objc_library(
+    name = "glfw_cocoa",
+    srcs = [
+        "src/cocoa_init.m",
+        "src/cocoa_joystick.m",
+        "src/cocoa_monitor.m",
+        "src/cocoa_time.c",
+        "src/cocoa_window.m",
+        "src/nsgl_context.m",
+        "src/posix_thread.c",
+    ],
+    hdrs = glob(["src/*.h"]) + [
+        "include/GLFW/glfw3.h",
+        "include/GLFW/glfw3native.h",
+    ],
+    copts = [
+        "-isystem",
+        "include",
+        "-std=c99",
+        "-fno-objc-arc",
+    ],
+    defines = ["_GLFW_COCOA"],
+    includes = ["include"],
+    sdk_frameworks = [
+        "Cocoa",
+        "IOKit",
+        "CoreFoundation",
+        "QuartzCore",
+    ],
+    visibility = ["//visibility:private"],
+)
diff --git a/MODULE.bazel b/MODULE.bazel
new file mode 100644
index 00000000..dcfdf080
--- /dev/null
+++ b/MODULE.bazel
@@ -0,0 +1,10 @@
+module(
+    name = "glfw",
+    version = "0.0.0",
+)
+
+bazel_dep(name = "apple_support", version = "1.22.1", repo_name = "build_bazel_apple_support")
+bazel_dep(name = "bazel_skylib", version = "1.7.1")
+
+bazel_dep(name = "rules_cc", version = "0.1.4")
+bazel_dep(name = "platforms", version = "1.0.0")
-- 
2.39.3 (Apple Git-146)
